---
title: "PlaywrightのVSCode拡張を使って効率的にテストを書く"
emoji: "🐷"
type: "tech"
topics: ["フロントエンド", "Playwright", "VSCode"]
published: false
publication_name: "cybozu_frontend"
---

この記事では、PlaywrightのVSCode拡張を使ってGUI操作のみでテストの記録や実行を行う方法について紹介します。

## VSCode拡張を活用してテストを書く

本記事では、シンプルなToDoアプリを例にテストの作成方法を説明します。Playwrightのインストール方法は、[公式ドキュメント](https://playwright.dev/docs/intro)をご参照ください。その後、VSCodeにPlaywrightの拡張機能を追加します。

VSCode拡張のインストール後、以下の機能を利用してテストコードの作成・実行していきます。

- Record at cursor: テストの記録
- Pick locator: locatorのコピー
- ブラウザモードでのテスト実行
- 独自のconfigを活用する

## Record at cursorを使ったテストの記録

まず、`tests/todo.spec.ts`を作成し、テストの雛形を作成します。

```ts:tests/todo.spec.ts
import { test, expect } from "@playwright/test";

test.describe("Todo App", () => {
  test("ToDoを追加できること", async ({ page }) => {
    await page.goto("http://localhost:3002");
  });
});
```

VSCodeのサイドバーにあるテストの項目を選択すると、Playwrightの各種機能が一覧表示されます。ここから「Record at cursor」を選択します。

![Record at cursorでテストを追加](/images/6c2a54196f056d/record-test.gif)

この機能を使うと、実際のブラウザでの操作がリアルタイムでテストコードに反映されます。GUIベースでの操作を直感的に行えるので、特定のLocatorの位置を直接コードから探す手間が省けます。

記録された操作をもとに、生成されたテストコードは以下のようになります。

```ts
  test("ToDoを追加できること", async ({ page }) => {
    await page.goto("http://localhost:3002");
    await page.getByLabel("Todo").click();
    await page.getByLabel("Todo").fill("todo 1");
    await page.getByLabel("Todo").press("Enter");
  });
```

## Pick locatorを使ってlocatorをコピーする

次に実際にtodoが追加されていることを確認します。
「Pick locator」を選択してブラウザ上でカーソルを当てると、その要素のセレクタが表示されます。クリックするとVSCodeの上に表示され、Enterを押すとクリップボードにコピーされます。

![Pick locatorでlocatorをコピーする](/images/6c2a54196f056d/copy-locator.gif)

コピーしたセレクタを使用して、todoが追加されていることを検証します。表示の確認には、locatorの[isVisible](https://playwright.dev/docs/api/class-locator#locator-is-visible
)を使います。

```ts
  test("ToDoを追加できること", async ({ page }) => {
    await page.goto("http://localhost:3002");
    await page.getByLabel("Todo").click();
    await page.getByLabel("Todo").fill("todo 1");
    await page.getByLabel("Todo").press("Enter");
    const isVisible = await page
      .getByRole("listitem")
      .locator("div")
      .filter({ hasText: "todo 1" })
      .isVisible();
    await expect(isVisible).toBeTruthy();
  });
```

テストの実行は、VSCodeのサイドバーにある再生ボタンをクリックするだけです。正常に実行されると、passed と表示されます。

```sh
Running 1 test using 1 worker
  1 passed (826ms)
```

## ブラウザモードでテストを実行する

テストをブラウザモードで実行するためには、「Show Browser」オプションにチェックを入れるだけです。これにより、テスト実行中のブラウザの動作をリアルタイムで確認することができます。

![ブラウザモードでテストを実行](/images/6c2a54196f056d/run-in-browser.gif)

## 独自のconfigを活用する

Playwrightでは、独自のconfigファイルを通じてテスト設定をカスタマイズできます。例として、異なるbaseUrlを用いてテストを行いたい場合、以下のようなconfigを利用できます。

```ts:playwright.local.config.ts
import { defineConfig } from "@playwright/test";

import baseConfig from "./playwright.config";

const config = defineConfig({
  ...baseConfig,
  workers: 2,
  use: {
    baseURL: "http://localhost:3002",
  },
});

export default config;
```

テストエクスプローラーの左端にある歯車をクリックすると、configを選択することができます。

![特定のconfigを読み込んでテストを実行する](/images/6c2a54196f056d/use-specific-config.gif)

baseURLを設定すれば、`page.goto("/")` を実行した際にこのbaseURLが適用されます。従って、前回のように明示的にURLを指定せずに処理を行うことができます。

```ts
  test("ToDoを追加できること", async ({ page }) => {
    await page.goto("/"); // baseUrlが適用される
    // (省略)
  });
```

常に特定のconfigを使用したい場合、デフォルトのconfigとして設定することもできます。

![規定のプロファイルを変更する](/images/6c2a54196f056d/change-profile.gif)

これにより、一度設定してからは、テストエクスプローラーの再生ボタンを押すだけで指定したconfigを元に実行されます。ブラウザも指定したものが起動されます。

## まとめ

PlaywrightのVSCode拡張を使うと、簡単なGUI操作でテストコードの記録や、テストを実行できます。また独自のconfigを読み込むこともできるので、テストの実行環境を柔軟に変更することができます。

今回紹介した以外にも、便利な機能があるのでぜひ活用してみてください！

今回使用したソースコードは公開しているので、興味ある方は参考までにご覧ください。

https://github.com/ryo-manba/next-playwright

## 参考

https://playwright.dev/docs/getting-started-vscode